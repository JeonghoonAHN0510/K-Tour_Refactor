<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!--
  정규화 DTO만 사용하고, 원본DTO는 생성하지 않습니다.
  SELECT 시 원본 컬럼을 정규화 DTO의 필드명으로 AS 별칭을 맞춰 반환합니다.
  @author OngTK
-->
<mapper namespace="ktour.model.mapper.SyncMapper">

    <!-- [1-1] 카테고리 테이블 생성========================================================= -->
    <update id="createCategoryTable">
        CREATE TABLE categoryCode (
            ccNo SMALLINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,			-- 분류체계번호[PK]
            rnum SMALLINT NOT NULL,										-- 일련번호(#TourAPI 연동컬럼)
            lclsSystm1Cd CHAR(9) NOT NULL, 								-- 대분류코드(#TourAPI 연동컬럼)
            lclsSystm1Nm VARCHAR(15) NOT NULL, 							-- 대분류명(#TourAPI 연동컬럼)
            lclsSystm2Cd CHAR(18) NOT NULL,								-- 중분류코드(#TourAPI 연동컬럼)
            lclsSystm2Nm VARCHAR(30) NOT NULL, 							-- 중분류명(#TourAPI 연동컬럼)
            lclsSystm3Cd CHAR(30) NOT NULL,								-- 소분류코드(#TourAPI 연동컬럼)
            lclsSystm3Nm VARCHAR(30) NOT NULL,							-- 소분류명(#TourAPI 연동컬럼)
            isActivate BOOLEAN DEFAULT TRUE, 							-- 활성화여부(FALSE:비노출, TRUE:노출) ※DB복사시 카테고리 코드를 갖는 다른 테이블/데이터 복사설정 : 본사는 모두 true 업체는 부분 true
            createdAt DATETIME DEFAULT CURRENT_TIMESTAMP,				-- 등록일(최초 DB복사일)
            updatedAt DATETIME DEFAULT NULL								-- 수정일(DB업데이트일/해당 레코드 수정일)
              ON UPDATE CURRENT_TIMESTAMP
        );
    </update>
    <!-- [1-2] 카테고리 코드 동기화========================================================= -->
    <insert id="insertCategoryCodeFromOrigin">
        INSERT INTO categorycode ( rnum, lclsSystm1Cd, lclsSystm1Nm, lclsSystm2Cd, lclsSystm2Nm, lclsSystm3Cd, lclsSystm3Nm )
        SELECT rnum, lclsSystm1Cd, lclsSystm1Nm, lclsSystm2Cd, lclsSystm2Nm, lclsSystm3Cd, lclsSystm3Nm
        FROM tour_api_origin.lclssystmcode2;
    </insert>

    <!-- [2-1] 법정동 테이블 생성========================================================= -->
    <update id="createLDongCodeTable">
        CREATE TABLE ldongCode (
            ldNo SMALLINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,		-- 법정동코드번호[PK] *첫글자 주의! L의 소문자 l 임.
            rnum SMALLINT UNSIGNED NOT NULL,						-- 일련번호(#TourAPI 연동컬럼)
            lDongRegnCd CHAR(5) NOT NULL, 							-- 시도코드(#TourAPI 연동컬럼) *36110 : 세종특별자치시
            lDongRegnNm VARCHAR(20) NOT NULL, 						-- 시도명(#TourAPI 연동컬럼)
            lDongSignguCd CHAR(5) NOT NULL, 						-- 시군구코드(#TourAPI 연동컬럼)
            lDongSignguNm VARCHAR(20) NOT NULL, 					-- 시군구명(#TourAPI 연동컬럼)
            isActivate BOOLEAN DEFAULT FALSE, 						-- 활성화여부(false:비노출, true:노출) ※DB복사시 법정동 코드를 갖는 다른 테이블/데이터 복사설정 : 본사는 모두 true 업체는 부분 true
            mapy DECIMAL(13,10) NOT NULL, 							-- 중심지역위도(시/군/구청 기준 지역중심 좌표)
            mapx DECIMAL(13,10) NOT NULL, 							-- 중심지역경도(시/군/구청 기준 지역중심 좌표)
            createdAt DATETIME DEFAULT CURRENT_TIMESTAMP,			-- 등록일(최초 DB복사일)
            updatedAt DATETIME DEFAULT NULL							-- 수정일(DB업데이트일/해당 레코드 수정일)
               ON UPDATE CURRENT_TIMESTAMP
        );
    </update>
    <!-- [2-2] 법정동 코드 동기화========================================================= -->
    <insert id="insertLDongCodeFromOrigin">
        INSERT INTO ldongcode ( rnum, lDongRegnCd, lDongRegnNm, lDongSignguCd, lDongSignguNm, mapy, mapx )
        SELECT rnum, lDongRegnCd, lDongRegnNm, lDongSignguCd, lDongSignguNm, 0.0, 0.0
        FROM tour_api_origin.ldongcode2;
    </insert>

    <!-- [3-1] 관광정보 동기화 목록 테이블 생성 ========================================================= -->
    <update id="createPlaceInfoTable">
        CREATE TABLE placeInfo (
            pNo INT UNSIGNED AUTO_INCREMENT PRIMARY KEY,			-- place번호[PK]
            ctNo TINYINT UNSIGNED,									-- 콘텐츠타입번호[FK]
            ldNo SMALLINT UNSIGNED,									-- 법정동코드번호[FK] *첫글자 주의! L의 소문자 l 임.
            ccNo SMALLINT UNSIGNED,									-- 분류체계번호[FK]
            isEditable BOOLEAN DEFAULT TRUE,						-- 수정 가능 여부
            contentid INT,									        -- 콘텐츠ID(#TourAPI 연동컬럼)
            title VARCHAR(255) NOT NULL,							-- 콘텐츠명/제목 (#TourAPI 연동컬럼)
            showflag TINYINT DEFAULT 0,								-- 콘텐츠 표출여부(#TourAPI 연동컬럼)
            firstimage VARCHAR(255),								-- 대표원본이미지(#TourAPI 연동컬럼)
            firstimage2 VARCHAR(255),								-- 대표섬네일이미지(#TourAPI 연동컬럼)
            addr1 VARCHAR(255) NOT NULL,							-- 기본주소(#TourAPI 연동컬럼)
            addr2 VARCHAR(100),										-- 상세주소(#TourAPI 연동컬럼)
            zipcode VARCHAR(10),									-- 우편번호(#TourAPI 연동컬럼)
            homepage TEXT,											-- 홈페이지링크(#TourAPI 연동컬럼)
            tel TEXT,												-- 전화(#TourAPI 연동컬럼)
            telname VARCHAR(30),									-- 전화번호명(#TourAPI 연동컬럼)
            overview TEXT,											-- 개요(#TourAPI 연동컬럼)
            createdAt DATETIME DEFAULT CURRENT_TIMESTAMP,			-- 등록일(최초 DB복사일)
            updatedAt DATETIME DEFAULT NULL							-- 수정일(DB업데이트일/해당 레코드 수정일)
               ON UPDATE CURRENT_TIMESTAMP,

            CONSTRAINT fk_placeInfo_contentType
               FOREIGN KEY (ctNo) REFERENCES contentType(ctNo)
                   ON UPDATE CASCADE
                   ON DELETE SET NULL,

            CONSTRAINT fk_placeInfo_ldongCode
               FOREIGN KEY (ldNo) REFERENCES ldongCode(ldNo)
                   ON UPDATE CASCADE
                   ON DELETE SET NULL,

            CONSTRAINT fk_placeInfo_categoryCode
               FOREIGN KEY (ccNo) REFERENCES categoryCode(ccNo)
                   ON UPDATE CASCADE
                   ON DELETE SET NULL
        );
    </update>

    <!-- [3-2] 관광정보 동기화 목록 동기화 ========================================================= -->
    <insert id="insertPlaceInfoFromOrigin">
        INSERT INTO placeinfo (ctNo, ldNo, ccNo, isEditable, contentid, title, showflag, firstimage, firstimage2, addr1, addr2, zipcode, homepage, tel, telname, overview, createdAt, updatedAt)
        SELECT
            /* FK: contentType.ctNo */
            ( SELECT ct.ctNo
              FROM contentType ct
              WHERE ct.contenttypeID = TRIM(al.contenttypeid)
                LIMIT 1 ) AS ctNo,

                /* FK: ldongCode.ldNo (법정동: lDongRegnCd + lDongSignguCd) */
                ( SELECT ld.ldNo
                FROM ldongCode ld
                WHERE ld.lDongRegnCd = TRIM(al.lDongRegnCd)
                AND ld.lDongSignguCd = TRIM(al.lDongSignguCd)
                LIMIT 1 ) AS ldNo,

                /* FK: categoryCode.ccNo (al.lclsSystm3 기준 매칭) */
                ( SELECT cc.ccNo
                FROM categoryCode cc
                WHERE cc.lclsSystm3Cd =
                UPPER(TRIM(REPLACE(REPLACE(REPLACE(REPLACE(
                al.lclsSystm3, CHAR(13), ''), CHAR(10), ''), CHAR(9), ''), ' ', '')))
                LIMIT 1 ) AS ccNo,

                TRUE AS isEditable,
                CAST(al.contentid AS UNSIGNED) AS contentid,
                LEFT(TRIM(al.title), 50) AS title,
                al.showflag AS showflag,
                NULLIF(TRIM(al.firstimage), '') AS firstimage,
                NULLIF(TRIM(al.firstimage2), '') AS firstimage2,
                COALESCE(NULLIF(TRIM(al.addr1), ''), '-') AS addr1,
                NULLIF(TRIM(al.addr2), '') AS addr2,
                NULLIF(TRIM(al.zipcode), '') AS zipcode,

                /* 부가정보: dc가 있으면 채움, 없으면 NULL */
                NULLIF(TRIM(dc.homepage), '') AS homepage,
                LEFT(NULLIF(TRIM(al.tel), ''), 10) AS tel,
                NULLIF(TRIM(dc.telname), '') AS telname,
                NULLIF(dc.overview, '') AS overview,

                /* [] createdAt, updatedAt을 DATETIME 형식으로 변환 */
                STR_TO_DATE(al.createdtime, '%Y%m%d%H%i%s') AS createdAt,
                STR_TO_DATE(al.modifiedtime, '%Y%m%d%H%i%s') AS updatedAt

        FROM tour_api_origin.areabasedsynclist2 al
            LEFT JOIN tour_api_origin.detailcommon2 dc
        ON CAST(TRIM(al.contentid) AS UNSIGNED) = CAST(TRIM(dc.contentid) AS UNSIGNED);
    </insert>

    <!-- [4-1] 지도마커GPS 테이블 생성 ========================================================= -->
    <update id="createMarkersGPSTable">
        CREATE TABLE markersGPS (
            mkNo INT UNSIGNED AUTO_INCREMENT PRIMARY KEY,			-- 마커번호[PK]
            pNo INT UNSIGNED,										-- place번호[FK]
            mkURL VARCHAR(255),										-- 마커이미지경로
            mapx DECIMAL(13,10),									-- GPS X좌표(#TourAPI 연동컬럼)
            mapy DECIMAL(13,10),									-- GPS Y좌표(#TourAPI 연동컬럼)
            createdAt DATETIME DEFAULT CURRENT_TIMESTAMP,			-- 등록일(최초 DB복사일)
            updatedAt DATETIME DEFAULT NULL							-- 수정일(DB업데이트일/해당 레코드 수정일)
                ON UPDATE CURRENT_TIMESTAMP,

            CONSTRAINT fk_makersGPS_placeInfo
                FOREIGN KEY (pNo) REFERENCES placeInfo(pNo)
                    ON UPDATE CASCADE
                    ON DELETE CASCADE
        );
    </update>

    <!-- [4-2] 지도마커GPS 동기화 ========================================================= -->
    <insert id="insertMarkersGPSFromOrigin">
        INSERT INTO markersgps (pNo, mapx, mapy)
        SELECT kpi.pNo, tabsl2.mapx, tabsl2.mapy
        FROM placeinfo kpi
                 LEFT OUTER JOIN tour_api_origin.areabasedsynclist2 tabsl2
                                 USING (contentid)
        WHERE tabsl2.mapy &lt; 1000
    </insert>

    <!-- [5-1] Place상세이미지 테이블 생성 ========================================================= -->
    <update id="createPlaceImageDetailTable">
        CREATE TABLE placeImageDetail (
            pidNo INT UNSIGNED AUTO_INCREMENT PRIMARY KEY,			-- 상세이미지번호[PK]
            pNo INT UNSIGNED,										-- place번호[FK]
            isEditable BOOLEAN DEFAULT TRUE,						-- 수정 가능 여부
            serialnum VARCHAR(11),									-- 이미지일련번호(#TourAPI 연동컬럼)
            originimgurl VARCHAR(255),								-- 원본이미지(#TourAPI 연동컬럼)
            smallimageurl VARCHAR(255),								-- 썸네일이미지(#TourAPI 연동컬럼)
            imgname VARCHAR(100),									-- 이미지명(#TourAPI 연동컬럼)
            createdAt DATETIME DEFAULT CURRENT_TIMESTAMP,			-- 등록일(최초 DB복사일)
            updatedAt DATETIME DEFAULT NULL							-- 수정일(DB업데이트일/해당 레코드 수정일)
              ON UPDATE CURRENT_TIMESTAMP,

            CONSTRAINT fk_placeImageDetail_placeInfo
              FOREIGN KEY (pNo) REFERENCES placeInfo(pNo)
                  ON UPDATE CASCADE
                  ON DELETE CASCADE
        );
    </update>

    <!-- [5-2] Place상세이미지 동기화 ========================================================= -->
    <insert id="insertPlaceImageDetailFromOrigin">
        INSERT INTO placeimagedetail (pNo, serialnum, originimgurl, smallimageurl, imgname)
        SELECT kpi.pNo, tdi.serialnum, tdi.originimgurl, tdi.smallimageurl, tdi.imgname
        FROM placeinfo kpi
                 JOIN tour_api_origin.detailimage2 tdi
                      USING (contentid);
    </insert>

    <!-- [6-1] 반려동물 동반여행정보 테이블 생성 ========================================================= -->
    <update id="createDetailPetTourTable">
        CREATE TABLE detailPetTour (
            dptNo INT UNSIGNED AUTO_INCREMENT PRIMARY KEY,			-- 반려동물 동반여행 번호[PK]
            pNo INT UNSIGNED,										-- place번호[FK]
            relaAcdntRiskMtr TEXT,									-- 관련 사고 대비사항(#TourAPI 연동컬럼)
            acmpyTypeCd VARCHAR(50),								-- 동반유형코드(동반구분)(#TourAPI 연동컬럼)
            relaPosesFclty TEXT,									-- 관련 구비 시설(#TourAPI 연동컬럼)
            relaFrnshPrdlst VARCHAR(255),							-- 관련 비치 품목(#TourAPI 연동컬럼)
            etcAcmpyInfo TEXT,										-- 기타 동반 정보(#TourAPI 연동컬럼)
            relaPurcPrdlst VARCHAR(255),							-- 관련 구매 품목(#TourAPI 연동컬럼)
            acmpyPsblCpam TEXT,										-- 동반가능동물(#TourAPI 연동컬럼)
            relaRntlPrdlst VARCHAR(255),							-- 관련 렌탈 품목(#TourAPI 연동컬럼)
            acmpyNeedMtr VARCHAR(50),								-- 동반시 필요사항(#TourAPI 연동컬럼)
            petTursmInfo VARCHAR(255),								-- 반려동물 관광정보(#TourAPI 연동컬럼)
            createdAt DATETIME DEFAULT CURRENT_TIMESTAMP,			-- 등록일(최초 DB복사일)
            updatedAt DATETIME DEFAULT NULL							-- 수정일(DB업데이트일/해당 레코드 수정일)
               ON UPDATE CURRENT_TIMESTAMP,

            CONSTRAINT fk_detailPetTour_placeInfo
               FOREIGN KEY (pNo) REFERENCES placeInfo(pNo)
                   ON UPDATE CASCADE
                   ON DELETE CASCADE
        );
    </update>

    <!-- [6-2] 반려동물 동반여행정보 동기화 ========================================================= -->
    <insert id="insertDetailPetTourFromOrigin">
        INSERT INTO detailpettour (pNo, relaAcdntRiskMtr, acmpyTypeCd, relaPosesFclty, relaFrnshPrdlst, etcAcmpyInfo, relaPurcPrdlst, acmpyPsblCpam, relaRntlPrdlst, acmpyNeedMtr)
        SELECT kpi.pNo, tdpt.relaAcdntRiskMtr, tdpt.acmpyTypeCd, tdpt.relaPosesFclty, tdpt.relaFrnshPrdlst,
               tdpt.etcAcmpyInfo, tdpt.relaPurcPrdlst, tdpt.acmpyPsblCpam, tdpt.relaRntlPrdlst, tdpt.acmpyNeedMtr
        FROM placeinfo kpi
                 JOIN tour_api_origin.detailpettour2 tdpt
                      USING (contentid);
    </insert>

    <!-- [7-1] 관광지 상세정보 테이블 생성 ========================================================= -->
    <update id="createTourIntroTable">
        CREATE TABLE tourIntro (
            tiNo INT UNSIGNED AUTO_INCREMENT PRIMARY KEY,		-- 관광지소개번호[PK]
            pNo INT UNSIGNED,									-- place번호[FK]
            accomcount VARCHAR(255),							-- 수용인원(#TourAPI 연동컬럼)
            chkbabycarriage VARCHAR(255),						-- 유모차대여정보(#TourAPI 연동컬럼)
            chkcreditcard VARCHAR(10),							-- 신용카드가능정보(#TourAPI 연동컬럼)
            chkpet VARCHAR(10),									-- 애완동물동반가능정보(#TourAPI 연동컬럼)
            expagerange VARCHAR(255),							-- 체험가능연령(#TourAPI 연동컬럼)
            expguide VARCHAR(255),								-- 체험안내(#TourAPI 연동컬럼)
            heritage1 VARCHAR(255),								-- 세계문화유산유무1(#TourAPI 연동컬럼)
            heritage2 VARCHAR(10),								-- 세계문화유산유무2(#TourAPI 연동컬럼)
            heritage3 VARCHAR(10),								-- 세계문화유산유무3(#TourAPI 연동컬럼)
            infocenter VARCHAR(255),							-- 문의및안내(#TourAPI 연동컬럼)
            opendate VARCHAR(255),								-- 개장일(#TourAPI 연동컬럼)
            parking VARCHAR(255),								-- 주차시설(#TourAPI 연동컬럼)
            restdate VARCHAR(255),								-- 쉬는날(#TourAPI 연동컬럼)
            useseason VARCHAR(255),								-- 이용시기(#TourAPI 연동컬럼)
            usetime VARCHAR(255),								-- 이용시간(#TourAPI 연동컬럼)
            createdAt DATETIME DEFAULT CURRENT_TIMESTAMP,		-- 등록일(최초 DB복사일)
            updatedAt DATETIME DEFAULT NULL						-- 수정일(DB업데이트일/해당 레코드 수정일)
               ON UPDATE CURRENT_TIMESTAMP,

            CONSTRAINT fk_tourIntro_placeInfo
               FOREIGN KEY (pNo) REFERENCES placeInfo(pNo)
                   ON UPDATE CASCADE
                   ON DELETE CASCADE
        );
    </update>

    <!-- [7-2] 관광지 상세정보 동기화 ========================================================= -->
    <insert id="insertTourIntroFromOrigin">
        INSERT INTO tourintro
        (pNo, accomcount, chkbabycarriage, chkcreditcard, chkpet, expagerange, expguide,
         heritage1, heritage2, heritage3, infocenter, opendate, parking, restdate, useseason, usetime)
        SELECT kpi.pNo, tdi12.accomcount, tdi12.chkbabycarriage, tdi12.chkcreditcard, tdi12.chkpet, tdi12.expagerange, tdi12.expguide,
               tdi12.heritage1, tdi12.heritage2, tdi12.heritage3, tdi12.infocenter, tdi12.opendate, tdi12.parking, tdi12.restdate, tdi12.useseason, tdi12.usetime
        FROM placeinfo kpi
                 JOIN tour_api_origin.detailintro2_12 tdi12
                      USING (contentid);
    </insert>

    <!-- [8-1] 축제행사공연 상세정보 테이블 생성 ========================================================= -->
    <update id="createFestivalIntroTable">
        CREATE TABLE festivalIntro (
            fiNo INT UNSIGNED AUTO_INCREMENT PRIMARY KEY,			-- 축제행사번호[PK]
            pNo INT UNSIGNED,										-- place번호[FK]
            eventstartdate VARCHAR(255),							-- 행사시작일(#TourAPI 연동컬럼)
            eventenddate VARCHAR(255),								-- 행사종료일(#TourAPI 연동컬럼)
            progresstype VARCHAR(10),								-- 진행상태정보(#TourAPI 연동컬럼)
            festivaltype VARCHAR(10),								-- 축제유형명(#TourAPI 연동컬럼)
            agelimit VARCHAR(255),									-- 관람가능연령(#TourAPI 연동컬럼)
            bookingplace VARCHAR(255),								-- 예매처(#TourAPI 연동컬럼)
            discountinfofestival VARCHAR(255),						-- 할인정보(#TourAPI 연동컬럼)
            eventhomepage VARCHAR(255),								-- 행사홈페이지(#TourAPI 연동컬럼)
            eventplace VARCHAR(255),								-- 행사장소(#TourAPI 연동컬럼)
            festivalgrade VARCHAR(255),								-- 축제등급(#TourAPI 연동컬럼)
            placeinfo VARCHAR(255),									-- 행사장위치안내(#TourAPI 연동컬럼)
            playtime VARCHAR(100),									-- 공연시간(#TourAPI 연동컬럼)
            program VARCHAR(255),									-- 행사프로그램(#TourAPI 연동컬럼)
            spendtimefestival VARCHAR(255),							-- 관람소요시간(#TourAPI 연동컬럼)
            sponsor1 VARCHAR(30),									-- 주최자정보(#TourAPI 연동컬럼)
            sponsor1tel VARCHAR(50),								-- 주최자연락처(#TourAPI 연동컬럼)
            sponsor2 VARCHAR(100),									-- 주관사정보(#TourAPI 연동컬럼)
            sponsor2tel TEXT,										-- 주관사연락처(#TourAPI 연동컬럼)
            subevent VARCHAR(255),									-- 부대행사(#TourAPI 연동컬럼)
            usetimefestival VARCHAR(100),							-- 이용요금(#TourAPI 연동컬럼)
            createdAt DATETIME DEFAULT CURRENT_TIMESTAMP,			-- 등록일(최초 DB복사일)
            updatedAt DATETIME DEFAULT NULL							-- 수정일(DB업데이트일/해당 레코드 수정일)
               ON UPDATE CURRENT_TIMESTAMP,

            CONSTRAINT fk_festivalIntro_placeInfo
               FOREIGN KEY (pNo) REFERENCES placeInfo(pNo)
                   ON UPDATE CASCADE
                   ON DELETE CASCADE
        );
    </update>

    <!-- [8-2] 축제행사공연 상세정보 동기화 ========================================================= -->
    <insert id="insertFestivalIntroFromOrigin">
        INSERT INTO festivalIntro
        (pNo, eventstartdate, eventenddate, progresstype, festivaltype, agelimit, bookingplace, discountinfofestival, eventhomepage, eventplace,
         festivalgrade, placeinfo, playtime, program, spendtimefestival, sponsor1, sponsor1tel, sponsor2, sponsor2tel, subevent, usetimefestival)
        SELECT kpi.pNo, tdi15.eventstartdate, tdi15.eventenddate, tdi15.progresstype, tdi15.festivaltype, tdi15.agelimit, tdi15.bookingplace, tdi15.discountinfofestival, tdi15.eventhomepage, tdi15.eventplace,
               tdi15.festivalgrade, tdi15.placeinfo, tdi15.playtime, tdi15.program, tdi15.spendtimefestival, tdi15.sponsor1, tdi15.sponsor1tel, tdi15.sponsor2, tdi15.sponsor2tel, tdi15.subevent, tdi15.usetimefestival
        FROM placeinfo kpi
                 JOIN tour_api_origin.detailintro2_15 tdi15
                      USING (contentid);
    </insert>

    <!-- [9-1] 음식점 상세정보 테이블 생성 ========================================================= -->
    <update id="createRestaurantIntroTable">
        CREATE TABLE restaurantIntro (
            riNo INT UNSIGNED AUTO_INCREMENT PRIMARY KEY,			-- 음식점소개 번호[PK]
            pNo INT UNSIGNED,										-- place번호[FK]
            chkcreditcardfood VARCHAR(100),							-- 신용카드가능정보(#TourAPI 연동컬럼)
            discountinfofood VARCHAR(255),							-- 할인정보(#TourAPI 연동컬럼)
            firstmenu VARCHAR(100),									-- 대표메뉴(#TourAPI 연동컬럼)
            infocenterfood VARCHAR(255),							-- 문의및안내(#TourAPI 연동컬럼)
            kidsfacility TINYINT UNSIGNED DEFAULT 0,				-- 어린이놀이방여부(#TourAPI 연동컬럼)
            lcnsno VARCHAR(12),										-- 인허가번호(#TourAPI 연동컬럼)
            opendatefood VARCHAR(100),								-- 개업일(#TourAPI 연동컬럼)
            opentimefood VARCHAR(255),								-- 영업시간(#TourAPI 연동컬럼)
            packing VARCHAR(100),									-- 포장가능(#TourAPI 연동컬럼)
            parkingfood VARCHAR(100),								-- 주차시설(#TourAPI 연동컬럼)
            reservationfood VARCHAR(255),							-- 예약안내(#TourAPI 연동컬럼)
            restdatefood VARCHAR(100),								-- 쉬는날(#TourAPI 연동컬럼)
            scalefood VARCHAR(100),									-- 규모(#TourAPI 연동컬럼)
            seat VARCHAR(100),										-- 좌석수(#TourAPI 연동컬럼)
            smoking VARCHAR(100),									-- 금연/흡연여부(#TourAPI 연동컬럼)
            treatmenu TEXT,											-- 취급메뉴(#TourAPI 연동컬럼)
            createdAt DATETIME DEFAULT CURRENT_TIMESTAMP,			-- 등록일(최초 DB복사일)
            updatedAt DATETIME DEFAULT NULL							-- 수정일(DB업데이트일/해당 레코드 수정일)
             ON UPDATE CURRENT_TIMESTAMP,

            CONSTRAINT fk_restaurantIntro_placeInfo
             FOREIGN KEY (pNo) REFERENCES placeInfo(pNo)
                 ON UPDATE CASCADE
                 ON DELETE CASCADE
        );
    </update>

    <!-- [9-2] 음식점 상세정보 동기화 ========================================================= -->
    <insert id="insertRestaurantIntroFromOrigin">
        INSERT INTO restaurantintro
        (pNo, chkcreditcardfood, discountinfofood, firstmenu, infocenterfood, kidsfacility, lcnsno, opendatefood,
         opentimefood, packing, parkingfood, reservationfood, restdatefood, scalefood, seat, smoking, treatmenu)
        SELECT kpi.pNo, tdi39.chkcreditcardfood, tdi39.discountinfofood, tdi39.firstmenu, tdi39.infocenterfood, tdi39.kidsfacility, tdi39.lcnsno, tdi39.opendatefood,
               tdi39.opentimefood, tdi39.packing, tdi39.parkingfood, tdi39.reservationfood, tdi39.restdatefood, tdi39.scalefood, tdi39.seat, tdi39.smoking, tdi39.treatmenu
        FROM placeinfo kpi
                 JOIN tour_api_origin.detailintro2_39 tdi39
                      USING (contentid);
    </insert>

    <!-- [10-1] Place 반복정보 테이블 생성 ========================================================= -->
    <update id="createPlaceInfoRepeatTable">
        CREATE TABLE placeInfoRepeat (
            pirNo INT UNSIGNED AUTO_INCREMENT PRIMARY KEY,			-- place반복번호[PK]
            pNo INT UNSIGNED,										-- place번호[FK]
            fldgubun TINYINT UNSIGNED,								-- 구분일련번호(#TourAPI 연동컬럼)
            infoname VARCHAR(30),									-- 제목(#TourAPI 연동컬럼)
            infotext TEXT,											-- 내용(#TourAPI 연동컬럼)
            serialnum TINYINT UNSIGNED NOT NULL,					-- 반복일련번호(#TourAPI 연동컬럼)
            createdAt DATETIME DEFAULT CURRENT_TIMESTAMP,			-- 등록일(최초 DB복사일)
            updatedAt DATETIME DEFAULT NULL							-- 수정일(DB업데이트일/해당 레코드 수정일)
             ON UPDATE CURRENT_TIMESTAMP,

            CONSTRAINT fk_placeInfoRepeat_placeInfo
             FOREIGN KEY (pNo) REFERENCES placeInfo(pNo)
                 ON UPDATE CASCADE
                 ON DELETE CASCADE
        );
    </update>

    <!-- [10-2] Place 반복정보 동기화 ========================================================= -->
    <insert id="insertPlaceInfoRepeatFromOrigin">
        INSERT INTO placeinforepeat(pNo, fldgubun, infoname, infotext, serialnum)
        SELECT kpi.pNo, tdi12.fldgubun, tdi12.infoname, tdi12.infotext, tdi12.serialnum
        FROM placeinfo kpi
                 JOIN tour_api_origin.detailinfo2_12 tdi12
                      USING (contentid)
        UNION ALL
        SELECT kpi.pNo, tdi39.fldgubun, tdi39.infoname, tdi39.infotext, tdi39.serialnum
        FROM placeinfo kpi
                 JOIN tour_api_origin.detailinfo2_39 tdi39
                      USING (contentid)
        UNION ALL
        SELECT kpi.pNo, tdi39.fldgubun, tdi39.infoname, tdi39.infotext, tdi39.serialnum
        FROM placeinfo kpi
                 JOIN tour_api_origin.detailinfo2_39 tdi39
                      USING (contentid);
    </insert>

    <!-- [11-1] 콘텐츠타입 테이블 생성========================================================= -->
    <update id="createContentTypeTable">
        CREATE TABLE contentType (
            ctNo TINYINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,       -- 콘텐츠타입No[PK]
            contenttypeid VARCHAR(5) NOT NULL,                		-- 콘텐츠타입ID( *TourAPI연동 컬럼* )
            contentTypeName VARCHAR(30) NOT NULL,           		-- 콘텐츠타입명
            defaultMarker VARCHAR(255) NOT NULL,           			-- 기본마커이미지
            createdAt DATETIME DEFAULT CURRENT_TIMESTAMP,         	-- 등록일(최초 DB복사일)
            updatedAt DATETIME DEFAULT NULL							-- 수정일(DB업데이트일/해당 레코드 수정일)
             ON UPDATE CURRENT_TIMESTAMP,
            memo TEXT                                       		-- 비고
        );
    </update>

    <!-- [11-2] 콘텐츠타입 샘플 추가========================================================= -->
    <insert id="insertContentTypeSample">
        INSERT INTO contentType
            (contenttypeid, contentTypeName, defaultMarker)
        VALUES
            ('12', '관광지', 'tourSpot.png'),
            ('14', '문화시설', 'culturalFacilities.png'),
            ('15', '행사/공연/축제', 'festival.png'),
            ('25', '여행코스', 'travelCourse.png'),
            ('28', '레포츠', 'leports.png'),
            ('32', '숙박', 'stay.png'),
            ('38', '쇼핑', 'shopping.png'),
            ('39', '음식점', 'food.png');
    </insert>

    <!-- [12-1] 사이트정보 테이블 생성========================================================= -->
    <update id="createSiteInfoTable">
        CREATE TABLE siteInfo (
            siNo INT UNSIGNED AUTO_INCREMENT PRIMARY KEY,   -- 사이트번호[PK]
            siName VARCHAR(50) NOT NULL UNIQUE,             -- 사이트명
            siDomain VARCHAR(100) NOT NULL UNIQUE,          -- 도메인(URL)
            siIntro VARCHAR(255),                           -- 사이트소개글
            siLogo VARCHAR(255),                            -- 사이트로고이미지
            siFavicon VARCHAR(255),                         -- 파비콘이미지
            siMarker VARCHAR(255),                          -- 마커이미지
            siTel VARCHAR(20),                              -- 대표전화
            siPrivacyOfficer VARCHAR(30),                   -- 개인정보처리책임자
            siEmail VARCHAR(100),                           -- 대표이메일
            siKeywords VARCHAR(255),                        -- 사이트 검색키워드
            siIsPublic TINYINT NOT NULL DEFAULT 0,       	-- 사이트 공개여부(0 : 비공개, 1 : 공개)
            createdAt DATETIME DEFAULT CURRENT_TIMESTAMP, 	-- 생성일시
            updatedAt DATETIME DEFAULT NULL 				-- 수정일시
              ON UPDATE CURRENT_TIMESTAMP,
            siMemo TEXT                                     -- 메모
        );
    </update>

    <!-- [13-1] 관리자정보 테이블 생성========================================================= -->
    <update id="createManagerTable">
        CREATE TABLE manager (
            mgNo INT UNSIGNED AUTO_INCREMENT PRIMARY KEY, 					-- 관리자No[PK]
            siNo INT UNSIGNED,												-- 사이트No[FK]
            mId VARCHAR(60) NOT NULL UNIQUE,                              	-- 아이디
            mPwd VARCHAR(60) NOT NULL,                                    	-- 패스워드
            mName VARCHAR(60) NOT NULL,                              		-- 이름
            mNick VARCHAR(60) NOT NULL UNIQUE,                            	-- 닉네임
            mGender ENUM('남', '여') NOT NULL,                      		  	-- 성별
            mPhone VARCHAR(16) NOT NULL UNIQUE,                           	-- 전화번호
            mEmail VARCHAR(255) NOT NULL UNIQUE,                          	-- 이메일
            zipCode VARCHAR(15) NOT NULL,                                   -- 우편번호
            mAddr1 VARCHAR(255) NOT NULL,                                  	-- 도로명 주소
            mAddr2 VARCHAR(255),                                           	-- 상세 주소
            createdAt DATETIME DEFAULT CURRENT_TIMESTAMP,                  	-- 가입일
            updatedAt DATETIME DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP,	-- 수정일
            deletedAt DATETIME DEFAULT NULL,                             	-- 탈퇴일
            mTermsAgreed BOOLEAN NOT NULL,                                	-- 이용약관 동의
            mLocationAgreed BOOLEAN NOT NULL,                             	-- 위치정보 동의
            mPushAgreed BOOLEAN NOT NULL,                                 	-- 푸시알림 동의
            memo TEXT,                                       				-- 이슈/메모
            mType TINYINT UNSIGNED NOT NULL DEFAULT 1,                      -- 회원유형(0=관리자회원, 1=일반회원, 2=사업자, 3=단체,모임)
            mgAuth TINYINT UNSIGNED NOT NULL DEFAULT 1,                     -- 관리자유형(0=시스템관리자, 1=업체(지자체)관리자)

            CONSTRAINT fk_manager_siteInfo
             FOREIGN KEY (siNo) REFERENCES siteInfo(siNo)
                 ON UPDATE CASCADE
                 ON DELETE CASCADE
        );
    </update>

    <!-- [14-1] 푸시/팝업 테이블 생성========================================================= -->
    <update id="createPushPopupTable">
        CREATE TABLE pushPopup (
            ppNo INT UNSIGNED AUTO_INCREMENT PRIMARY KEY,		-- 푸시팝업No[PK]
            pNo INT UNSIGNED,					        		-- place번호[FK]
            mgNo INT UNSIGNED,									-- 관리자No[FK]
            ppTitle VARCHAR(150) NOT NULL,						-- 제목
            ppContent VARCHAR(255),								-- 내용
            ppImg VARCHAR(255),									-- 이미지
            ppUse TINYINT NOT NULL,				                -- 사용구분(1.푸시알림+팝업 / 2.푸시알림 / 3.팝업)
            ppType TINYINT NOT NULL,				            -- 카테고리(1.공지 / 2.이벤트)
            createdAt DATETIME DEFAULT CURRENT_TIMESTAMP,		-- 작성일
            updatedAt DATETIME DEFAULT NULL						-- 수정일
               ON UPDATE CURRENT_TIMESTAMP,
            ppStart DATETIME NOT NULL,							-- 노출시작일
            ppEnd DATETIME NOT NULL,							-- 노출종료일
            ppIterated TIME,									-- 푸시알림 시간(*09~20시 사이 분단위)

            CONSTRAINT fk_pushPopup_placeInfo
               FOREIGN KEY (pNo) REFERENCES placeInfo(pNo)
                   ON UPDATE CASCADE
                   ON DELETE CASCADE,

            CONSTRAINT fk_pushPopup_manager
               FOREIGN KEY (mgNo) REFERENCES manager(mgNo)
                   ON UPDATE CASCADE
                   ON DELETE SET NULL
        );
    </update>
</mapper>
